#!/bin/bash
set -e

current_branch=$(git rev-parse --abbrev-ref HEAD)
remote_name="${1:-origin}"

# Fetch the remote branch (safe; won't merge)
git fetch "$remote_name" "$current_branch" >/dev/null 2>&1 || true

# If the remote branch exists, count commits we are behind
if git show-ref --verify --quiet "refs/remotes/$remote_name/$current_branch"; then
  behind_count=$(git rev-list --count HEAD.."$remote_name"/"$current_branch")
else
  behind_count=0
fi

if [ "$behind_count" -ne 0 ]; then
  echo "❌ Your branch '$current_branch' is behind $remote_name/$current_branch by $behind_count commits."
  echo "📌 Please run: git pull --rebase $remote_name $current_branch"
  exit 1
fi

exit 0